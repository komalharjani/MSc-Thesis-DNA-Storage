let text = "How promotion excellent curiosity yet attempted happiness. Gay prosperous impression had conviction. For every delay death ask style. Me mean able my by in they. Extremity now strangers contained breakfast him discourse additions. Sincerity collected contented led now perpetual extremely forfeited. Two assure edward whence the was. Who worthy yet ten boy denote wonder. Weeks views her sight old tears sorry. Additions can suspected its concealed put furnished. Met the why particular devonshire decisively considered partiality. Certain it waiting no entered is. Passed her indeed uneasy shy polite appear denied. Oh less girl no walk. At he spot with five of view. Months on ye at by esteem desire warmth former. Sure that that way gave any fond now. His boy middleton sir nor engrossed affection excellent. Dissimilar compliment cultivated preference eat sufficient may. Well next door soon we mr he four. Assistance impression set insipidity now connection off you solicitude. Under as seems we me stuff those style at. Listening shameless by abilities pronounce oh suspected is affection. Next it draw in draw much bred. Can curiosity may end shameless explained. True high on said mr on come. An do mr design at little myself wholly entire though. Attended of on stronger or mr pleasure. Rich four like real yet west get. Felicity in dwelling to drawings. His pleasure new steepest for reserved formerly disposed jennings. Boy desirous families prepared gay reserved add ecstatic say. Replied joy age visitor nothing cottage. Mrs door paid led loud sure easy read. Hastily at perhaps as neither or ye fertile tedious visitor. Use fine bed none call busy dull when. Quiet ought match my right by table means. Principles up do in me favourable affronting. Twenty mother denied effect we to do on. Not him old music think his found enjoy merry. Listening acuteness dependent at or an. Apartments thoroughly unsatiable terminated sex how themselves. She are ten hours wrong walls stand early. Domestic perceive on an ladyship extended received do. Why jennings our whatever his learning gay perceive. Is against no he without subject. Bed connection unreserved preference partiality not unaffected. Years merit trees so think in hoped we as. On am we offices expense thought. Its hence ten smile age means. Seven chief sight far point any. Of so high into easy. Dashwoods eagerness oh extensive as discourse sportsman frankness. Husbands see disposed surprise likewise humoured yet pleasure. Fifteen no inquiry cordial so resolve garrets as. Impression was estimating surrounded solicitude indulgence son shy. How promotion excellent curiosity yet attempted happiness. Gay prosperous impression had conviction. For every delay death ask style. Me mean able my by in they. Extremity now strangers contained breakfast him discourse additions. Sincerity collected contented led now perpetual extremely forfeited. Two assure edward whence the was. Who worthy yet ten boy denote wonder. Weeks views her sight old tears sorry. Additions can suspected its concealed put furnished. Met the why particular devonshire decisively considered partiality. Certain it waiting no entered is. Passed her indeed uneasy shy polite appear denied. Oh less girl no walk. At he spot with five of view. Months on ye at by esteem desire warmth former. Sure that that way gave any fond now. His boy middleton sir nor engrossed affection excellent. Dissimilar compliment cultivated preference eat sufficient may. Well next door soon we mr he four. Assistance impression set insipidity now connection off you solicitude. Under as seems we me stuff those style at. Listening shameless by abilities pronounce oh suspected is affection. Next it draw in draw much bred. Can curiosity may end shameless explained. True high on said mr on come. An do mr design at little myself wholly entire though. Attended of on stronger or mr pleasure. Rich four like real yet west get. Felicity in dwelling to drawings. His pleasure new steepest for reserved formerly disposed jennings. Boy desirous families prepared gay reserved add ecstatic say. Replied joy age visitor nothing cottage. Mrs door paid led loud sure easy read. Hastily at perhaps as neither or ye fertile tedious visitor. Use fine bed none call busy dull when. Quiet ought match my right by table means. Principles up do in me favourable affronting. Twenty mother denied effect we to do on. Not him old music think his found enjoy merry. Listening acuteness dependent at or an. Apartments thoroughly unsatiable terminated sex how themselves. She are ten hours wrong walls stand early. Domestic perceive on an ladyship extended received do. Why jennings our whatever his learning gay perceive. Is against no he without subject. Bed connection unreserved preference partiality not unaffected. Years merit trees so think in hoped we as. On am we offices expense thought. Its hence ten smile age means. Seven chief sight far point any. Of so high into easy. Dashwoods eagerness oh extensive as discourse sportsman frankness. Husbands see disposed surprise likewise humoured yet pleasure. Fifteen no inquiry cordial so resolve garrets as. Impression was estimating surrounded solicitude indulgence son shy.How promotion excellent curiosity yet attempted happiness. Gay prosperous impression had conviction. For every delay death ask style. Me mean able my by in they. Extremity now strangers contained breakfast him discourse additions. Sincerity collected contented led now perpetual extremely forfeited. Two assure edward whence the was. Who worthy yet ten boy denote wonder. Weeks views her sight old tears sorry. Additions can suspected its concealed put furnished. Met the why particular devonshire decisively considered partiality. Certain it waiting no entered is. Passed her indeed uneasy shy polite appear denied. Oh less girl no walk. At he spot with five of view. Months on ye at by esteem desire warmth former. Sure that that way gave any fond now. His boy middleton sir nor engrossed affection excellent. Dissimilar compliment cultivated preference eat sufficient may. Well next door soon we mr he four. Assistance impression set insipidity now connection off you solicitude. Under as seems we me stuff those style at. Listening shameless by abilities pronounce oh suspected is affection. Next it draw in draw much bred. Can curiosity may end shameless explained. True high on said mr on come. An do mr design at little myself wholly entire though. Attended of on stronger or mr pleasure. Rich four like real yet west get. Felicity in dwelling to drawings. His pleasure new steepest for reserved formerly disposed jennings. Boy desirous families prepared gay reserved add ecstatic say. Replied joy age visitor nothing cottage. Mrs door paid led loud sure easy read. Hastily at perhaps as neither or ye fertile tedious visitor. Use fine bed none call busy dull when. Quiet ought match my right by table means. Principles up do in me favourable affronting. Twenty mother denied effect we to do on. Not him old music think his found enjoy merry. Listening acuteness dependent at or an. Apartments thoroughly unsatiable terminated sex how themselves. She are ten hours wrong walls stand early. Domestic perceive on an ladyship extended received do. Why jennings our whatever his learning gay perceive. Is against no he without subject. Bed connection unreserved preference partiality not unaffected. Years merit trees so think in hoped we as. On am we offices expense thought. Its hence ten smile age means. Seven chief sight far point any. Of so high into easy. Dashwoods eagerness oh extensive as discourse sportsman frankness. Husbands see disposed surprise likewise humoured yet pleasure. Fifteen no inquiry cordial so resolve garrets as. Impression was estimating surrounded solicitude indulgence son shy. How promotion excellent curiosity yet attempted happiness. Gay prosperous impression had conviction. For every delay death ask style. Me mean able my by in they. Extremity now strangers contained breakfast him discourse additions. Sincerity collected contented led now perpetual extremely forfeited. Two assure edward whence the was. Who worthy yet ten boy denote wonder. Weeks views her sight old tears sorry. Additions can suspected its concealed put furnished. Met the why particular devonshire decisively considered partiality. Certain it waiting no entered is. Passed her indeed uneasy shy polite appear denied. Oh less girl no walk. At he spot with five of view. Months on ye at by esteem desire warmth former. Sure that that way gave any fond now. His boy middleton sir nor engrossed affection excellent. Dissimilar compliment cultivated preference eat sufficient may. Well next door soon we mr he four. Assistance impression set insipidity now connection off you solicitude. Under as seems we me stuff those style at. Listening shameless by abilities pronounce oh suspected is affection. Next it draw in draw much bred. Can curiosity may end shameless explained. True high on said mr on come. An do mr design at little myself wholly entire though. Attended of on stronger or mr pleasure. Rich four like real yet west get. Felicity in dwelling to drawings. His pleasure new steepest for reserved formerly disposed jennings. Boy desirous families prepared gay reserved add ecstatic say. Replied joy age visitor nothing cottage. Mrs door paid led loud sure easy read. Hastily at perhaps as neither or ye fertile tedious visitor. Use fine bed none call busy dull when. Quiet ought match my right by table means. Principles up do in me favourable affronting. Twenty mother denied effect we to do on. Not him old music think his found enjoy merry. Listening acuteness dependent at or an. Apartments thoroughly unsatiable terminated sex how themselves. She are ten hours wrong walls stand early. Domestic perceive on an ladyship extended received do. Why jennings our whatever his learning gay perceive. Is against no he without subject. Bed connection unreserved preference partiality not unaffected. Years merit trees so think in hoped we as. On am we offices expense thought. Its hence ten smile age means. Seven chief sight far point any. Of so high into easy. Dashwoods eagerness oh extensive as discourse sportsman frankness. Husbands see disposed surprise likewise humoured yet pleasure. Fifteen no inquiry cordial so resolve garrets as. Impression was estimating surrounded solicitude indulgence son shy. ";
//let noErrors = 2;
//let text = "Hello my name is Komal."
var slider = document.getElementById("myRange");
var output = document.getElementById("demo");
let errorDisplay = document.getElementById("errorRateDisplay");
let errorRate;

output.innerHTML = slider.value; // Display the default slider value
slider.oninput = function () {
    output.innerHTML = this.value;
    errorRate = this.value;
}
let binOutput;


/**
 * Called when convert is started
 */
function onConvert() {

    let blocks = document.getElementById("fixed").checked;
    let revComp = document.getElementById("revComp").checked;
    let original = document.getElementById("original").checked;
    let comp = document.getElementById("comp").checked;
    let rev = document.getElementById("rev").checked;
    errorDisplay.innerHTML = "Specified Error Rate: " + errorRate + " Percent";
    let displayDNA = document.getElementById("dnaOutput");
    if (blocks) {

        //Add Length to String
        //let input = addLength();
        binOutput = textToBinary(text); //returns length + text
        //Add Encoding Information
        let dnaArray = binaryToDNA(binOutput); //convert to DNA
        console.log(dnaArray);
        //document.getElementById("dnaOutput").innerHTML = dnaStringOutput.join("");

        //STORE IN DNA?
        let lengthOfBlock = 5;

        console.log(dnaArray);
        let addBlock = addBlocks(dnaArray, lengthOfBlock);
        let blockArr = Array.from(addBlock).join("");
        console.log(blockArr);
        console.log(addBlock);
        //let primedOriginal = addPrimers(blockArr);

        //Create Clones
        let cloneOneString = blockArr.slice();
        let cloneTwoString = blockArr.slice();

        //Error Simulator
        let corruptClone = errorSimulator(cloneOneString);
        let corruptCloneTwo = errorSimulator(cloneTwoString);
        let corruptOriginal = errorSimulator(blockArr);

        displayDNA.innerHTML = blockArr;
        errorCorrectBlock(corruptClone, corruptCloneTwo, corruptOriginal);
    }

    if (original) {


        //Add Length to String
        let inputOG = addLength();
        binOutput = textToBinary(inputOG); //returns length + text

        //Add Encoding Information
        let dnaStringOutput = binaryToDNA(binOutput); //convert to DNA
        //document.getElementById("dnaOutput").innerHTML = dnaStringOutput.join("");

        //Add Primers - for Blocks
        let addedPrimers = addPrimers(dnaStringOutput);

        //Add Redundancy
        let cloneOne = addedPrimers.slice();
        let cloneTwo = addedPrimers.slice();

        //ERROR SIMULATOR
        let cloneError = errorSimulator(cloneOne);
        let cloneTwoError = errorSimulator(cloneTwo);
        let dnaStringError = errorSimulator(addedPrimers);

        let decoded = errorCorrect(dnaStringError, cloneError, cloneTwoError);
        let fin = binaryToText(decoded);
        //    document.getElementById("recoveredData").innerHTML = "Original: " + fin;
        console.log("Original: " + fin);


        //Calculate Similarity
        let similarity = similarText(text, fin);
        console.log(similarity);

        //Calculate Size
        console.log(binOutput.length);
        let size = binOutput.length * 0.000001;
        console.log(size);

        //Display Result
        let newPara = document.createElement('p');
        let label1 = document.createElement('h3');
        let label2 = document.createElement('p');
        let label3 = document.createElement('p');
        let similarityText = document.createElement('h3');
        let sizeOfText = document.createElement('h3');
        let TimeToRun = document.createElement('h3');
        label1.textContent = "Original Copies: ";
        label2.textContent = "Original Copies: ";
        label3.textContent = "Original Copies: ";
        newPara.textContent = fin;
        similarityText.textContent = "Similarity Match: " + similarity.toFixed(2) + "%";
        sizeOfText.textContent = "Size: " + size + " MB";
        document.getElementById("recoveredData").appendChild(label1);
        document.getElementById("recoveredData").appendChild(newPara);
        document.getElementById("recoveredData").appendChild(similarityText);
        document.getElementById("recoveredData").appendChild(sizeOfText);


        //Display Corrupt
        let corrupt = dnaToBinary(dnaStringError)
        decodeCorrupt = decode(corrupt);
        let out = lengthToText(decodeCorrupt);
        let corruptOutput = document.createElement('p');
        corruptOutput.textContent = out;
        document.getElementById("corruptData").appendChild(label2);
        document.getElementById("corruptData").appendChild(corruptOutput);

        //Display DNA
        let dnaOutput = document.createElement('p');
        dnaOutput.textContent = addedPrimers;
        document.getElementById("dnaOutput").appendChild(label3);
        document.getElementById("dnaOutput").appendChild(dnaOutput);


    }
    if (comp) {

        //Add Length to String
        let inputComp = addLength();
        binOutput = textToBinary(inputComp); //returns length + text

        //Add Encoding Information
        let dnaStringOutput = binaryToDNA(binOutput); //convert to DNA
        console.log(dnaStringOutput);
        //document.getElementById("dnaOutput").innerHTML = dnaStringOutput.join("");

        //Add Primers - for Blocks
        let addedPrimers = addPrimers(dnaStringOutput);
        let compCloneOne = getComplement(addedPrimers).join(""); //copy one
        let compCloneTwo = getComplement(addedPrimers).join("");

        //ERROR SIMULATOR
        let cloneError = errorSimulator(compCloneOne);
        let cloneTwoError = errorSimulator(compCloneTwo);
        let dnaStringError = errorSimulator(addedPrimers);

        //DECODE COMPLEMENT
        let decodeCompOne = getComplement(cloneError);
        let decodeCompTwo = getComplement(cloneTwoError);

        //ERROR CORRECT WITH REV COMPLEMENT
        let decoded = errorCorrect(dnaStringError, decodeCompOne, decodeCompTwo);
        let fin = binaryToText(decoded);
        // document.getElementById("recoveredData").append = "Complement: " + fin;
        console.log("Complement: " + fin);

        //Display Result
        let newPara = document.createElement('p');
        let label1 = document.createElement('p');
        let label2 = document.createElement('p');
        let label3 = document.createElement('p');
        label1.textContent = "Complement Copies: ";
        label2.textContent = "Complement Copies: ";
        label3.textContent = "Complement Copies: ";
        newPara.textContent = fin;
        document.getElementById("recoveredData").appendChild(label1);
        document.getElementById("recoveredData").appendChild(newPara);

        //Display Corrupt
        let corrupt = dnaToBinary(dnaStringError)
        decodeCorrupt = decode(corrupt);
        let out = lengthToText(decodeCorrupt);
        let corruptOutput = document.createElement('p');
        corruptOutput.textContent = out;
        document.getElementById("corruptData").appendChild(label2);
        document.getElementById("corruptData").appendChild(corruptOutput);

        //Display DNA
        let dnaOutput = document.createElement('p');
        dnaOutput.textContent = addedPrimers;
        document.getElementById("dnaOutput").appendChild(label3);
        document.getElementById("dnaOutput").appendChild(dnaOutput);

        let similarity = similarText(text, fin);
        console.log(similarity.toFixed(2));
    }

    if (rev) {

        //Add Length to String
        let input = addLength();
        binOutput = textToBinary(input); //returns length + text

        //Add Encoding Information
        let dnaStringOutput = binaryToDNA(binOutput); //convert to DNA
        console.log(dnaStringOutput);
        //document.getElementById("dnaOutput").innerHTML = dnaStringOutput.join("");


        //Add Primers - for Blocks
        let addedPrimersOrg = addPrimers(dnaStringOutput);
        let addedPrimersRev = addPrimers(dnaStringOutput.reverse());
        let clone = addedPrimersRev.slice();

        //ERROR SIMULATOR
        let cloneError = errorSimulator(addedPrimersRev);
        let cloneTwoError = errorSimulator(clone);
        let dnaStringError = errorSimulator(addedPrimersOrg);

        //REVERSE BACK
        cloneError = cloneError.reverse();
        cloneTwoError = cloneTwoError.reverse();

        //ERROR CORRECT WITH REV COMPLEMENT
        let decoded = errorCorrect(dnaStringError, cloneError, cloneTwoError);
        let fin = binaryToText(decoded);
        // document.getElementById("recoveredData").innerHTML = "Reversed: " + fin;
        console.log("Reversed: " + fin);

        //Display Result
        let newPara = document.createElement('p');
        let label1 = document.createElement('p');
        let label2 = document.createElement('p');
        let label3 = document.createElement('p');
        label1.textContent = "Reverse Copies: ";
        label2.textContent = "Reverse Copies: ";
        label3.textContent = "Reverse Copies: ";
        newPara.textContent = fin;
        document.getElementById("recoveredData").appendChild(label1);
        document.getElementById("recoveredData").appendChild(newPara);

        //Display Corrupt
        let corrupt = dnaToBinary(dnaStringError)
        decodeCorrupt = decode(corrupt);
        let out = lengthToText(decodeCorrupt);
        let corruptOutput = document.createElement('p');
        corruptOutput.textContent = out;
        document.getElementById("corruptData").appendChild(label2);
        document.getElementById("corruptData").appendChild(corruptOutput);

        //Display DNA
        let dnaOutput = document.createElement('p');
        dnaOutput.textContent = addedPrimers;
        document.getElementById("dnaOutput").appendChild(label3);
        document.getElementById("dnaOutput").appendChild(dnaOutput);

        let similarity = similarText(text, fin);
        console.log(similarity.toFixed(2));

    }

    if (revComp) {

        //Add Length to String
        let input = addLength();
        binOutput = textToBinary(input); //returns length + text

        //Add Encoding Information
        let dnaStringOutput = binaryToDNA(binOutput); //convert to DNA
        console.log(dnaStringOutput);
        //document.getElementById("dnaOutput").innerHTML = dnaStringOutput.join("");


        //Add Primers - for Blocks
        let addedPrimers = addPrimers(dnaStringOutput);
        let revAddedPrimers = addPrimers(dnaStringOutput.reverse());
        let compCloneOne = getComplement(revAddedPrimers).join(""); //copy one
        let compCloneTwo = getComplement(revAddedPrimers).join("");

        //ERROR SIMULATOR
        let cloneError = errorSimulator(compCloneOne);
        let cloneTwoError = errorSimulator(compCloneTwo);
        let dnaStringError = errorSimulator(addedPrimers);

        //DECODE COMPLEMENT
        let decodeCompOne = getComplement(cloneError).reverse();
        let decodeCompTwo = getComplement(cloneTwoError).reverse();

        //ERROR CORRECT WITH REV COMPLEMENT
        let decoded = errorCorrect(dnaStringError, decodeCompOne, decodeCompTwo);
        let fin = binaryToText(decoded);

        //Display Result
        let newPara = document.createElement('p');
        let label1 = document.createElement('p');
        let label2 = document.createElement('p');
        let label3 = document.createElement('p');
        label1.textContent = "Reverse Complement Copies: ";
        label2.textContent = "Reverse Complement Copies: ";
        label3.textContent = "Reverse Complement Copies: ";
        newPara.textContent = fin;
        document.getElementById("recoveredData").appendChild(label1);
        document.getElementById("recoveredData").appendChild(newPara);

        //Display Corrupt
        let corrupt = dnaToBinary(dnaStringError)
        decodeCorrupt = decode(corrupt);
        let out = lengthToText(decodeCorrupt);
        let corruptOutput = document.createElement('p');
        corruptOutput.textContent = out;
        document.getElementById("corruptData").appendChild(label2);
        document.getElementById("corruptData").appendChild(corruptOutput);

        //Display DNA
        let dnaOutput = document.createElement('p');
        dnaOutput.textContent = addedPrimers;
        document.getElementById("dnaOutput").appendChild(label3);
        document.getElementById("dnaOutput").appendChild(dnaOutput);

        let similarity = similarText(text, fin);
        console.log(similarity.toFixed(2));
    }

}

function addBlocks(dnaArray, n) {

    //start at 5
    for (let i = 5; i < dnaArray.length; i += 6) {
        dnaArray.splice(i, 0, "TTTT");
    }
    let arr = dnaArray.join("");
    let block = Array.from(arr);

    return block;
}


function errorCorrect(dnaStringError, cloneError, cloneTwoError) {
    //AFTER THIS ERROR CORRECT
    //ERROR CORRECTOR
    let errorCorrection = errorCorrectRedundant(dnaStringError, cloneError, cloneTwoError);
    // console.log(errorCorrection);
    //Convert result to Binary
    let errorCorrectionResult = dnaToBinary(errorCorrection);
    //Remove Primers
    let convertedOutput = removePrimers(errorCorrectionResult);
    //Decode
    let decoded = decode(convertedOutput);
    return decoded;

}

function errorCorrectBlock(dnaStringError, cloneError, cloneTwoError) {

    //Run Error Correction - Modify to remove blocks
    let errorCorrection = errorCorrectRedundantBlock(dnaStringError, cloneError, cloneTwoError);
    // console.log(errorCorrection);

    for (let i = 5; i < errorCorrection.length; i += 5) {
        errorCorrection.splice(i, 4);
    }

    //Convert to Binary
    let errorCorrectionResult = dnaToBinary(errorCorrection);

    //Split into 8s
    let decoded = decode(errorCorrectionResult);

    //Print Result
    let fin = binaryToText(decoded);
    document.getElementById("recoveredData").innerHTML = fin;
}

function imageToBinary(img) {
    var binArray = []
    var datEncode = "";

    for (i = 0; i < data.length; i++) {
        binArray.push(data[i].charCodeAt(0).toString(2));
    }
    for (j = 0; j < binArray.length; j++) {
        var pad = padding_left(binArray[j], '0', 8);
        datEncode += pad + ' ';
    }
    function padding_left(s, c, n) {
        if (!s || !c || s.length >= n) {
            return s;
        }
        var max = (n - s.length) / c.length;
        for (var i = 0; i < max; i++) {
            s = c + s;
        } return s;
    }
    // console.log(binArray);
}

/**
 * Converting User Inputted Text into Binary using ASCII Table
 * @param {*} text
 */
function textToBinary(text) {
    var length = text.length,
        output = [];
    for (var i = 0; i < length; i++) {
        var bin = text[i].charCodeAt().toString(2);
        output.push(Array(8 - bin.length + 1).join("0") + bin);
    }
    return output.join("");
}

/**
 * Converting Binary Output to DNA by Mapping 2 bits to A, G, C or T.
 * Mapping: A = 00, G = 01, C = 10, T = 11
 * @param {*} binOutput 
 */
function binaryToDNA(binOutput) {
    // console.log(binOutput.length);
    let dnaArray = [];
    var twoBitsArray = []; //Array to hold binary elements, each element containing 2 bits
    var i = 0;
    var n = binOutput.length;

    while (i < n) {
        twoBitsArray.push(binOutput.slice(i, i += 2));
    }
    // console.log(twoBitsArray);

    for (let i = 0; i < twoBitsArray.length; i++) {
        if (twoBitsArray[i] == "00") {
            dnaArray.push("A");
        }
        else if (twoBitsArray[i] == "01") {
            dnaArray.push("G");
        }
        else if (twoBitsArray[i] == "10") {
            dnaArray.push("C");
        }
        else if (twoBitsArray[i] == "11") {
            dnaArray.push("T");
        }
    }
    return dnaArray;
}

/**
 * Control 1: Remove Homopolymers and 'GC' repeats
 */
function removeHomopolymers() {

}

/**
 * Add a Payload
 * @param {*} dnaArray 
 */
function addPrimers(dnaArray) {
    let stringed = dnaArray.join("");
    let primer = "AAAAA"; //Add Primer of 5 A's
    let dnaString = primer + stringed + primer;
    return dnaString;
}

function removePrimers(convertedOutput) {
    //check if all A's and then splice
    convertedOutput.splice(0, 5); //remove primer from beginning
    convertedOutput.splice(-5, 5); //remove primer from end
    return convertedOutput;

}

/**
 * 
 */
function addLength() {
    let padding = "00000000";
    let textLength = text.length;
    let noNums = textLength.toString().length;
    let zeros = 8 - noNums;
    let zerosPadding = padding.slice(0, zeros);
    let final = zerosPadding + textLength;
    // console.log(final);
    //length of DNA == 32 CHARACTERS AT THE END
    let finalText = text + final;
    return finalText;
}


/**
 * Generate Complement of DNA String to be stored
 */
function getComplement(dnaArray) {
    let complement = [];
    for (let i = 0; i < dnaArray.length; i++) {
        if (dnaArray[i] == "A") {
            complement.push("T");
        }
        if (dnaArray[i] == "T") {
            complement.push("A");
        }
        if (dnaArray[i] == "C") {
            complement.push("G");
        }
        if (dnaArray[i] == "G") {
            complement.push("C");
        }
    }
    //let comp = complement.join("");
    return complement;
}

/**
 * Error Simulator to delete random information
 * Attempting to mimic sequencing and synthesis errors in practice 
 * @param {*} dnaString 
 */
function errorSimulator(dnaString) { //does this have to deal with a string?
    let noErrors = Math.round(dnaString.length * errorRate / 1000); //error rate user input
    dnaArray = dnaString.split("");
    console.log(dnaArray);
    let dispersed = document.getElementById("dispersed").checked;
    let endDNA = document.getAnimations("endDNA")
    let subError = ["A", "G", "T", "C"];
    let min;
    if (dispersed) {
        min = 0; //change if errors should be concentrated at end
        console.log(min);
    }
    if (endDNA) {
        min = dnaString.length - 200;
        console.log(min);
    }

    //User Specified
    let noRunsInsert = document.getElementById("insertChars").value;
    let noRunsDelete = document.getElementById("deleteChars").value;
    let noRunsSub = document.getElementById("subChars").value;

    let del = document.getElementById("delete").checked;
    if (del) {
        for (let i = 0; i < noErrors; i++) { //for error rate
            let randomIndex = (Math.floor(Math.random() * dnaArray.length - min + 1) + min) + 1; //generate random index
            dnaArray.splice(randomIndex, noRunsDelete);
        }
    }
    else if (sub) {
        for (let i = 0; i < noErrors; i++) { //for error rate
            let randomIndex = (Math.floor(Math.random() * dnaArray.length - min + 1) + min) + 1; //generate random index
            let randomElement = subError[Math.floor(Math.random() * subError.length)];
            dnaArray.splice(randomIndex, 1, randomElement);
        }
    }
    else if (insert) {
        for (let i = 0; i < noErrors; i++) {
            let randomIndex = Math.floor(Math.random() * (dnaArray.length - min + 1) + min); //generate random index
            for (let j = 0; j < noRunsSub; j++) {
                let randomElement = subError[Math.floor(Math.random() * subError.length)];
                dnaArray.splice(randomIndex, 0, randomElement);
                randomIndex++;
            }
        }
    }
    // for (let i = 0; i < noErrors; i++) { //for error rate
    //     // let randomIndex = (Math.floor(Math.random() * dnaArray.length - min + 1) + min) + 1; //generate random index
    //     // console.log(randomIndex);
    //     // //deletion error
    //     // if(del) {
    //     //     dnaArray.splice(randomIndex, 1);
    //     //     console.log(dnaArray);
    //     // }


    //     //insertion error
    //     let insert = document.getElementById("insert").checked;
    //     if(insert) {
    //         let randomElement = subError[Math.floor(Math.random() * subError.length)];
    //         dnaArray.splice(randomIndex,0,randomElement);
    //         console.log(dnaArray);
    //     }
    //     //substitution error
    //     let sub = document.getElementById("sub").checked;
    //     if(sub) {
    //         let randomElement = subError[Math.floor(Math.random() * subError.length)];
    //         dnaArray.splice(randomIndex,1,randomElement);
    //         console.log(dnaArray);
    //     }
    // }
    return dnaArray;
}

/**
 * 
 * @param {*} dnaString 
 */
function errorCorrectRedundant(errorDNA, cloneOne, cloneTwo, len) {

    let temp = [];
    let missing = [];
    let majority;

    let getLenClone = errorDNA.slice();
    let errorCorrectionResult = dnaToBinary(getLenClone);
    let convertedOutput = removePrimers(errorCorrectionResult);
    let decoded = decode(convertedOutput);
    lengthToText(decoded);
    let extractedLength = getLength(errorCorrectionResult); //call getLength from here
    console.log(extractedLength);
    console.log(getLenClone.length);

    let noErrors;
    noErrors = (extractedLength - getLenClone.length) * 3;

    while (noErrors > 0) {
        //Identifies the index of where the error has occured 
        for (let j = 0; j < errorDNA.length; j++) {
            if (errorDNA[j] === cloneOne[j] && errorDNA[j] === cloneTwo[j]) {
                temp.push(errorDNA[j]);
            }
            else {
                missing.push({
                    original: errorDNA[j],
                    cloneOne: cloneOne[j],
                    cloneTwo: cloneTwo[j]
                })
                break;
            }
        }

        let indexToInsert = temp.length;
        //correct in missing 

        for (let i = 0; i < missing.length; i++) {

            if (missing[i].original === missing[i].cloneOne) {
                majority = missing[i].original;
                cloneTwo.splice(indexToInsert, 0, majority);
            }
            else if (missing[i].original === missing[i].cloneTwo) {
                majority = missing[i].original;
                cloneOne.splice(indexToInsert, 0, majority);
            }
            else if (missing[i].cloneTwo === missing[i].cloneOne) {
                majority = missing[i].cloneTwo;
                errorDNA.splice(indexToInsert, 0, majority);
            }
            else {
                majority = "X";
                cloneOne.splice(indexToInsert, 0, majority);
            }
        }
        missing = [];
        temp = [];
        majority = "";
        noErrors--;
    }
    return errorDNA;

}

function errorCorrectRedundantBlock(errorDNA, cloneOne, cloneTwo, len) {

    let temp = [];
    let missing = [];
    let majority;

    errorRate = 10;

    while (errorRate > 0) {
        //Identifies the index of where the error has occured 
        for (let j = 0; j < errorDNA.length; j++) {
            if (errorDNA[j] === cloneOne[j] && errorDNA[j] === cloneTwo[j]) {
                temp.push(errorDNA[j]);
            }
            else {
                missing.push({
                    original: errorDNA[j],
                    cloneOne: cloneOne[j],
                    cloneTwo: cloneTwo[j]
                })
                break;
            }
        }

        let indexToInsert = temp.length;
        //correct in missing 

        for (let i = 0; i < missing.length; i++) {
            if (missing[i].original === missing[i].cloneOne) {
                majority = missing[i].original;
                cloneTwo.splice(indexToInsert, 0, majority);

            }
            else if (missing[i].original === missing[i].cloneTwo) {
                majority = missing[i].original;
                cloneOne.splice(indexToInsert, 0, majority);

            }
            else if (missing[i].cloneTwo === missing[i].cloneOne) {
                majority = missing[i].cloneTwo;
                errorDNA.splice(indexToInsert, 0, majority);

            }
        }
        missing = [];
        temp = [];
        majority = "";
        errorRate--;
    }
    //check that there are 30 characters in between every TTTT
    return errorDNA;
}

/**
 * 
 * @param {*} decodedResult 
 */
function getLength(decodedResult) {
    //decodedResult.splice(-5, 5); //remove primer from en
    let removeNum = decodedResult.length - 32;
    decodedResult.splice(0, removeNum);
    let extractedLength = decode(decodedResult);
    let finalNum = lengthToText(extractedLength);
    let num = finalNum.replace(/^0+/, '');
    let dnaLength = (num * 4) + 42;
    console.log(dnaLength);
    return dnaLength;
}

/**
 * Convert error corrected string back to binary  
 * @param {*} dnaString 
 */
function dnaToBinary(dnaString) {
    let decodedResult = [];

    for (let i = 0; i < dnaString.length; i++) {
        if (dnaString[i] == "A") {
            decodedResult.push("00");
        }
        if (dnaString[i] == "G") {
            decodedResult.push("01");
        }
        if (dnaString[i] == "C") {
            decodedResult.push("10");
        }
        if (dnaString[i] == "T") {
            decodedResult.push("11");
        }
    }
    console.log(decodedResult);
    return decodedResult;

}

function decode(convertedOutput) {
    let conv = convertedOutput.join("");
    // console.log(conv);

    let temp = [];
    var i = 0;
    var n = conv.length;

    while (i < n) {
        temp.push(conv.slice(i, i += 8));
    }

    // console.log(temp);
    temp = temp.join(" ");
    return temp;
}

/**
 * Map Binary back to text using ASCII character codes
 * @param {*} str 
 */
function binaryToText(str) {
    // console.log(str);
    var binString = '';
    str.split(' ').map(function (bin) {
        binString += String.fromCharCode(parseInt(bin, 2));
    });
    return binString;
}

function lengthToText(str) {
    // console.log(str);
    var binString = '';
    str.split(' ').map(function (bin) {
        binString += String.fromCharCode(parseInt(bin, 2));
    });
    //console.log(binString);
    return binString;
}

function displayResults() {
    //1. Show All On Page
    //2. Compare Algorithm
    //3. Retrieval Rate Algorithm
    //4. Work Out File Size
    //5. Running Time Work Out
    //6. Save as File
}

function similarText(first, second) {
    // http://jsphp.co/jsphp/fn/view/similar_text
    // +   original by: RafaÅ‚ Kukawski (http://blog.kukawski.pl)
    // +   bugfixed by: Chris McMacken
    // *     example 1: similar_text('Hello World!', 'Hello phpjs!');
    // *     returns 1: 7
    // *     example 2: similar_text('Hello World!', null);
    // *     returns 2: 0
    if (first === null || second === null || typeof first === 'undefined' || typeof second === 'undefined') {
        return 0;
    }

    first += '';
    second += '';

    var pos1 = 0,
        pos2 = 0,
        max = 0,
        firstLength = first.length,
        secondLength = second.length,
        p, q, l, sum;

    max = 0;

    for (p = 0; p < firstLength; p++) {
        for (q = 0; q < secondLength; q++) {
            for (l = 0;
                (p + l < firstLength) && (q + l < secondLength) && (first.charAt(p + l) === second.charAt(q + l)); l++);
            if (l > max) {
                max = l;
                pos1 = p;
                pos2 = q;
            }
        }
    }

    sum = max;

    if (sum) {
        if (pos1 && pos2) {
            sum += this.similarText(first.substr(0, pos2), second.substr(0, pos2));
        }

        if ((pos1 + max < firstLength) && (pos2 + max < secondLength)) {
            sum += this.similarText(first.substr(pos1 + max, firstLength - pos1 - max), second.substr(pos2 + max, secondLength - pos2 - max));
        }
    }

    sum = sum / (text.length) * 100;
    return sum;
}